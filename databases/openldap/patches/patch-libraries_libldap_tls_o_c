Index: libraries/libldap/tls_o.c
--- libraries/libldap/tls_o.c.orig
+++ libraries/libldap/tls_o.c
@@ -999,11 +999,11 @@ no_cn:
 			ld->ld_error = LDAP_STRDUP(
 				_("TLS: unable to get CN from peer certificate"));
 
-		} else if ( cn->length == nlen &&
-			strncasecmp( name, (char *) cn->data, nlen ) == 0 ) {
+		} else if ( ASN1_STRING_length(cn) == nlen &&
+			strncasecmp( name, (const char *) ASN1_STRING_get0_data(cn), nlen ) == 0 ) {
 			ret = LDAP_SUCCESS;
 
-		} else if (( cn->data[0] == '*' ) && ( cn->data[1] == '.' )) {
+		} else if (( ASN1_STRING_get0_data(cn)[0] == '*' ) && ( ASN1_STRING_get0_data(cn)[1] == '.' )) {
 			char *domain = strchr(name, '.');
 			if( domain ) {
 				int dlen;
@@ -1011,8 +1011,8 @@ no_cn:
 				dlen = nlen - (domain-name);
 
 				/* Is this a wildcard match? */
-				if ((dlen == cn->length-1) &&
-					!strncasecmp(domain, (char *) &cn->data[1], dlen)) {
+				if ((dlen == ASN1_STRING_length(cn)-1) &&
+					!strncasecmp(domain, (const char *) &ASN1_STRING_get0_data(cn)[1], dlen)) {
 					ret = LDAP_SUCCESS;
 				}
 			}
@@ -1021,7 +1021,7 @@ no_cn:
 		if( ret == LDAP_LOCAL_ERROR ) {
 			Debug3( LDAP_DEBUG_ANY, "TLS: hostname (%s) does not match "
 				"common name in certificate (%.*s).\n", 
-				name, cn->length, cn->data );
+				name, ASN1_STRING_length(cn), ASN1_STRING_get0_data(cn) );
 			ret = LDAP_CONNECT_ERROR;
 			if ( ld->ld_error ) {
 				LDAP_FREE( ld->ld_error );
